{% extends "base.html" %}

{% block title %}Browse Books - BookBazaar{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Discover Your Next Great Read</h1>
    {% if query %}
        <p class="page-subtitle">Search results for "{{ query }}"</p>
    {% else %}
        <p class="page-subtitle">Explore our curated collection of books</p>
    {% endif %}
</div>

<div class="books-container">
    {% if books %}
        <div class="books-grid">
            {% for book in books %}
                <div class="book-card">
                    <div class="book-image">
                        {% if book.image_url and book.image_url.strip() %}
                            <img src="{{ book.image_url }}" alt="{{ book.title }}">
                        {% else %}
                            <div class="book-placeholder">
                                <span class="placeholder-icon">üìñ</span>
                                <span class="placeholder-text">No Image</span>
                            </div>
                        {% endif %}
                        {% if book.stock < 1 %}
                            <div class="out-of-stock-badge">Out of Stock</div>
                        {% endif %}
                    </div>
                    <div class="book-details">
                        <h3 class="book-title">{{ book.title }}</h3>
                        <p class="book-author">by {{ book.author }}</p>
                        {% if book.seller %}
                            <p class="book-seller"><small>Sold by: {{ book.seller.username }}</small></p>
                        {% endif %}
                        {% if book.description %}
                            <p class="book-description">{{ book.description[:120] }}{% if book.description|length > 120 %}...{% endif %}</p>
                        {% endif %}
                        <div class="book-footer">
                            <span class="book-price">‚Çπ{{ "%.2f"|format(book.price) }}</span>
                            {% if book.stock > 0 %}
                                <div class="action-buttons">
                                    <form method="POST" action="{{ url_for('bookstore.place_order', book_id=book.id) }}" class="inline-form">
                                        <button type="submit" class="btn btn-secondary">Buy Now</button>
                                    </form>
                                    <form method="POST" action="{{ url_for('bookstore.add_to_cart', book_id=book.id) }}" class="inline-form">
                                        <button type="submit" class="btn btn-primary">Add to Cart</button>
                                    </form>
                                </div>
                            {% else %}
                                <button class="btn btn-disabled" disabled>Unavailable</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination Controls -->
        {% if pagination.pages > 1 %}
        <div class="pagination">
            {% if pagination.has_prev %}
                <a href="{{ url_for('bookstore.books', page=pagination.prev_num, q=query) }}" class="page-link prev-link">‚Üê Previous</a>
            {% else %}
                <span class="page-link disabled prev-link">‚Üê Previous</span>
            {% endif %}

            <div class="page-numbers">
                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                    {% if page_num %}
                        {% if pagination.page == page_num %}
                            <span class="page-number active">{{ page_num }}</span>
                        {% else %}
                            <a href="{{ url_for('bookstore.books', page=page_num, q=query) }}" class="page-number">{{ page_num }}</a>
                        {% endif %}
                    {% else %}
                        <span class="page-ellipsis">...</span>
                    {% endif %}
                {% endfor %}
            </div>

            {% if pagination.has_next %}
                <a href="{{ url_for('bookstore.books', page=pagination.next_num, q=query) }}" class="page-link next-link">Next ‚Üí</a>
            {% else %}
                <span class="page-link disabled next-link">Next ‚Üí</span>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <div class="empty-state">
            {% if query %}
                <p>üîç No books found matching "{{ query }}".</p>
                <a href="{{ url_for('bookstore.books') }}" class="btn btn-link">View all books</a>
            {% else %}
                <p>üìö No books available at the moment. Please check back later!</p>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
